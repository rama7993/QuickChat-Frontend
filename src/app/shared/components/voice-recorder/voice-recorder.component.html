<div class="voice-recorder" [class.recording]="isRecording()">
  <div class="recorder-container">
    <!-- Recording Controls -->
    <div class="recording-controls" *ngIf="!isRecording()">
      <button
        class="record-button"
        (click)="startRecording()"
        [attr.aria-label]="'Start voice recording'"
      >
        <i class="pi pi-microphone"></i>
      </button>
      <span class="record-label">Tap to record</span>
    </div>

    <!-- Active Recording -->
    <div class="active-recording" *ngIf="isRecording()">
      <div class="recording-header">
        <div class="recording-indicator">
          <div class="pulse-dot"></div>
          <span class="recording-text">Recording...</span>
        </div>
        <div class="recording-duration">
          {{ formatDuration(recordingDuration()) }}
        </div>
      </div>

      <!-- Enhanced Wave Visualization -->
      <div class="wave-container">
        <div class="wave-bars">
          <div
            class="wave-bar"
            *ngFor="let bar of waveBars; let i = index"
            [style.height.%]="bar.height"
            [style.animation-delay]="bar.delay + 'ms'"
            [style.width.px]="4"
            [class.active]="audioLevel() > 20"
          ></div>
        </div>
        <div class="wave-text">
          <span *ngIf="!isPaused()">Speak now...</span>
          <span *ngIf="isPaused()">Recording paused</span>
        </div>
        <div class="audio-level-indicator">
          <div class="level-bar" [style.width.%]="audioLevel()"></div>
        </div>
      </div>

      <!-- Recording Actions -->
      <div class="recording-actions">
        <button
          class="action-button pause-button"
          *ngIf="!isPaused()"
          (click)="pauseRecording()"
          [attr.aria-label]="'Pause recording'"
        >
          <i class="pi pi-pause"></i>
        </button>

        <button
          class="action-button resume-button"
          *ngIf="isPaused()"
          (click)="resumeRecording()"
          [attr.aria-label]="'Resume recording'"
        >
          <i class="pi pi-play"></i>
        </button>

        <button
          class="action-button send-button"
          (click)="stopRecording()"
          [attr.aria-label]="'Send recording'"
        >
          <i class="pi pi-send"></i>
        </button>

        <button
          class="action-button cancel-button"
          (click)="cancelRecording()"
          [attr.aria-label]="'Cancel recording'"
        >
          <i class="pi pi-times"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Hidden audio element for playback -->
  <audio #audioElement preload="none"></audio>
</div>
